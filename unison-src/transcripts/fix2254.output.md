
This transcript checks that updates to data types propagate successfully to dependent types and dependent terms that do pattern matching. First let's create some types and terms:

```unison
unique type A a b c d
  = A a
  | B b
  | C c
  | D d

structural type NeedsA a b = NeedsA (A a b Nat Nat)
                | Zoink Text

f : A Nat Nat Nat Nat -> Nat
f = cases
  A n -> n
  _ -> 42

f2 a =
  n = f a
  n + 1

f3 : NeedsA Nat Nat -> Nat
f3 = cases
  NeedsA a -> f a + 20
  _ -> 0

g : A Nat Nat Nat Nat -> Nat
g = cases
  D n -> n
  _ -> 43
```

We'll make our edits in a new branch.

```ucm
scratch/a> add

  ‚çü I've added these definitions:

    type A a b c d
    structural type NeedsA a b
    f  : A Nat Nat Nat Nat -> Nat
    f2 : A Nat Nat Nat Nat -> Nat
    f3 : NeedsA Nat Nat -> Nat
    g  : A Nat Nat Nat Nat -> Nat

scratch/a> branch a2

  Done. I've created the a2 branch based off of a.
  
  Tip: To merge your work back into the a branch, first
       `switch /a` then `merge /a2`.

```
First let's edit the `A` type, adding another constructor `E`. Note that the functions written against the old type have a wildcard in their pattern match, so they should work fine after the update.

```unison
unique type A a b c d
  = A a
  | B b
  | C c
  | D d
  | E a d
```

Let's do the update now, and verify that the definitions all look good and there's nothing `todo`:

```ucm
scratch/a2> update.old

  ‚çü I've updated these names to your new definition:

    type A a b c d

scratch/a2> view A NeedsA f f2 f3 g

<<<<<<< Conflict 1 of 5
%%%%%%% Changes from base to side #1
   type A a b c d
-    = B b
+    = A a
     | D d
     | E a d
+    | B b
     | C c
-    | A a
   
   structural type NeedsA a b
-    = Zoink Text
-    | NeedsA (A a b Nat Nat)
+    = NeedsA (A a b Nat Nat)
+    | Zoink Text
   
   f : A Nat Nat Nat Nat -> Nat
   f = cases
     A n -> n
     _   -> 42
   
   f2 : A Nat Nat Nat Nat -> Nat
   f2 a =
     use Nat +
     n = f a
     n + 1
   
   f3 : NeedsA Nat Nat -> Nat
   f3 = cases
     NeedsA a -> f a Nat.+ 20
     _        -> 0
   
   g : A Nat Nat Nat Nat -> Nat
   g = cases
     D n -> n
     _   -> 43
+++++++ Contents of side #2
  type A a b c d = B b | D d | E a d | C c | A a
>>>>>>> Conflict 1 of 5 ends

<<<<<<< Conflict 2 of 5
+++++++ Contents of side #1
scratch/a2> todo
%%%%%%% Changes from base to side #2
-.a2> todo
+  ‚ö†Ô∏è
>>>>>>> Conflict 2 of 5 ends

  The following names were not found in the codebase. Check your spelling.
    NeedsA
    f
    f2
    f3
    g

```

```ucm
.a2> update.old.a2> view A NeedsA f f2 f3 g.a2> todo
```
<<<<<<< Conflict 3 of 5
+++++++ Contents of side #1
```ucm
scratch/r1> add
%%%%%%% Changes from base to side #2
-```ucm
-.a3> add
>>>>>>> Conflict 3 of 5 ends


<<<<<<< Conflict 4 of 5
+++++++ Contents of side #1
scratch/r1> branch r2

  Done. I've created the r2 branch based off of r1.
  
  Tip: To merge your work back into the r1 branch, first
       `switch /r1` then `merge /r2`.

```
```unison
structural type Rec = { uno : Nat, dos : Nat, tres : Text }
```
%%%%%%% Changes from base to side #2
-```
-```unison
-structural type Rec = { uno : Nat, dos : Nat, tres : Text }
-```
+üõë
>>>>>>> Conflict 4 of 5 ends

The transcript failed due to an error in the stanza above. The error is:


  ‚ö†Ô∏è

  The following names were not found in the codebase. Check your spelling.
    NeedsA
    f
    f2
    f3
    g

<<<<<<< Conflict 5 of 5
%%%%%%% Changes from base to side #1
 ```ucm
-.> fork a3 a4
+scratch/r2> update.old
 
-  Done.
-
-.a4> update.old
-
   ‚çü I've added these definitions:
   
     Rec.tres        : Rec -> Text
     Rec.tres.modify : (Text ->{g} Text) -> Rec ->{g} Rec
     Rec.tres.set    : Text -> Rec -> Rec
   
   ‚çü I've updated these names to your new definition:
   
     structural type Rec
     Rec.dos        : Rec -> Nat
     Rec.dos.modify : (Nat ->{g} Nat) -> Rec ->{g} Rec
     Rec.dos.set    : Nat -> Rec -> Rec
     Rec.uno        : Rec -> Nat
     Rec.uno.modify : (Nat ->{g} Nat) -> Rec ->{g} Rec
     Rec.uno.set    : Nat -> Rec -> Rec
 
-.a4> todo
+scratch/r2> todo
 
   
 
 ```
+++++++ Contents of side #2
>>>>>>> Conflict 5 of 5 ends
